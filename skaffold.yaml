apiVersion: skaffold/v1beta5
kind: Config
build:
  artifacts:
  - image: garethjevans/kaniko-springboot
    context: .
    docker: {}
  tagPolicy:
    envTemplate:
      template: '{{.DOCKER_REGISTRY_FULL}}/{{.IMAGE_NAME}}:{{.VERSION}}'
deploy:
  kubectl: {}
test:
- image: garethjevans/kaniko-springboot 
  structureTests:
  - ./test/*
profiles:
- name: local
  build:
    local:
      push: false
- name: kaniko
  build:
    kaniko:
      buildContext:
        gcsBucket: jenkinsx-dev-skaffold-kaniko
      pullSecretName: kaniko-secret
      namespace: jx
      dockerConfig:
        secretName: jenkins-docker-cfg
      cache:
        repo: jenkins-x-docker-registry.jx.svc.cluster.local:5000/garethjevans/kaniko-springboot/cache

